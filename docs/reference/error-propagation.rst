.. _propagation_of_uncertainties:

Propagation of uncertainties
============================

If present, Scipp propagates uncertainties (errors) as described in `Wikipedia: Propagation of uncertainty <https://en.wikipedia.org/wiki/Propagation_of_uncertainty>`_.
The implemented mechanism assumes *uncorrelated data*.

An overview for key operations is:

.. table::
    :widths: 50 50

    +--------------------------+-------------------------------------------------------------------------+
    |Operation :math:`f`       |Variance :math:`\sigma^{2}_{f}`                                          |
    +==========================+=========================================================================+
    |:math:`-a`                |:math:`\sigma^{2}_{a}`                                                   |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`|a|`               |:math:`\sigma^{2}_{a}`                                                   |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\sqrt{a}`          |:math:`\frac{1}{4} \frac{\sigma^{2}_{a}}{a}`                             |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`a + b`             |:math:`\sigma^{2}_{a} + \sigma^{2}_{b}`                                  |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`a - b`             |:math:`\sigma^{2}_{a} + \sigma^{2}_{b}`                                  |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`a * b`             |:math:`\sigma^{2}_{a}b^{2} + \sigma^{2}_{b}a^{2}`                        |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`a / b`             |:math:`\frac{\sigma^{2}_{a} + \sigma^{2}_{b} \frac{a^{2}}{b^{2}}}{b^{2}}`|
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`e^{a}`             |:math:`e^{2a} \sigma^{2}_{a}`                                            |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\log(a)`           |:math:`\sigma^{2}_{a} / a^{2}`                                           |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\log_{10}(a)`      |:math:`\sigma^{2}_{a} \log^{2}(10) / a^{2}`                              |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\sin(a)` [#f1]_    |:math:`\sigma^{2}_{a} \cos^{2}(a)`                                       |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\cos(a)` [#f1]_    |:math:`\sigma^{2}_{a} \sin^{2}(a)`                                       |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\tan(a)` [#f1]_    |:math:`\sigma^{2}_{a} \left(\frac{1}{\cos^{2}(a)}\right)^{2}`            |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\arcsin(a)` [#f2]_ |:math:`\sigma^{2}_{a} \frac{1}{1 - a^{2}}`                               |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\arccos(a)` [#f2]_ |:math:`\sigma^{2}_{a} \frac{1}{1 - a^{2}}`                               |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\arctan(a)` [#f2]_ |:math:`\sigma^{2}_{a} \frac{1}{(1 - a^{2})^{2}}`                         |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\sinh(a)`          |:math:`\sigma^{2}_{a} \cosh^{2}(a)`                                      |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\cosh(a)`          |:math:`\sigma^{2}_{a} \sinh^{2}(a)`                                      |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\tanh(a)`          |:math:`\sigma^{2}_{a} \left(\frac{1}{\cosh^{2}(a)}\right)^{2}`           |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\text{arsinh}(a)`  |:math:`\sigma^{2}_{a} \frac{1}{a^{2} + 1}`                               |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\text{arcosh}(a)`  |:math:`\sigma^{2}_{a} \frac{1}{a^{2} - 1}`                               |
    +--------------------------+-------------------------------------------------------------------------+
    |:math:`\text{artanh}(a)`  |:math:`\sigma^{2}_{a} \frac{1}{(1 - a^{2})^{2}}`                         |
    +--------------------------+-------------------------------------------------------------------------+

The expression for division is derived from :math:`(\frac{\sigma_{a/b}}{a/b})^{2} = (\frac{\sigma_{a}}{a})^{2} + (\frac{\sigma_{b}}{b})^{2}`.

.. rubric:: Footnotes

.. [#f1] The input to trigonometric functions is converted to radians before propagating the uncertainties.
         This means that, e.g., the uncertainty of the sine function for an input in degrees is
         :math:`\sigma^{2}_{\sin} = \sigma^{2}_{a} (\pi/180)^{2} \cos^{2}(a)`.
.. [#f2] Variances are not defined for inverse trigonometric functions at :math:`\pm 1`.
